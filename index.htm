<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANOR-MATRIX | Neural Engine v3.0 - Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø­ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&family=IBM+Plex+Sans+Arabic:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <style>
        :root {
            --neon-blue: #3b82f6;
            --neon-emerald: #10b981;
            --neon-purple: #a855f7;
            --deep-bg: #020617;
        }

        body {
            background: var(--deep-bg);
            font-family: 'Outfit', 'IBM Plex Sans Arabic', sans-serif;
            overflow: hidden;
        }

        .glass {
            background: rgba(15, 23, 42, 0.7);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .brain-glow {
            filter: drop-shadow(0 0 15px rgba(59, 130, 246, 0.5));
            transition: filter 0.3s ease;
        }

        .brain-glow:hover {
            filter: drop-shadow(0 0 25px rgba(59, 130, 246, 0.8));
        }

        .matrix-dots {
            background-image: radial-gradient(rgba(59, 130, 246, 0.2) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(15px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .pulse-cell {
            position: relative;
        }

        .pulse-cell::after {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            animation: pulse-ring 2s infinite;
        }

        .log-line {
            border-right: 3px solid var(--neon-blue);
            padding-right: 12px;
            margin-bottom: 6px;
            animation: slideIn 0.3s ease-out;
            transition: all 0.2s ease;
        }

        .log-line:hover {
            border-right-color: var(--neon-emerald);
            background: rgba(16, 185, 129, 0.1);
            padding-right: 16px;
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        .glow-animation {
            animation: glowPulse 2s ease-in-out infinite;
        }

        .scanning {
            position: relative;
            overflow: hidden;
        }

        .scanning::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
            animation: scanline 2s linear infinite;
            z-index: 10;
        }

        .blink-text {
            animation: blink 1.5s ease-in-out infinite;
        }

        .error-badge {
            font-size: 10px;
            padding: 0 8px;
            padding-top: 4px;
            padding-bottom: 4px;
            border-radius: 9999px;
            transition: all 0.2s ease;
        }

        .error-badge:hover {
            transform: scale(1.05);
        }

        .file-item {
            border-right: 4px solid;
            padding: 12px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            background: rgba(30, 41, 59, 0.5);
            transform: translateX(-5px);
            border-right-width: 6px;
        }

        .neural-particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            border-radius: 50%;
            opacity: 0.5;
            animation: floatParticle 10s linear infinite;
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        .action-flash {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle, rgba(59,130,246,0.2) 0%, transparent 70%);
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-flash.active {
            opacity: 1;
        }

        .code-correction {
            position: relative;
        }

        .code-correction::after {
            content: 'âœ¨';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 20px;
            animation: float 1s ease-in-out infinite;
        }

        .typing-effect {
            border-left: 2px solid var(--neon-emerald);
            animation: blink 1s step-end infinite;
        }
    </style>
</head>

<body class="text-slate-100 selection:bg-blue-500/30">
    <div class="neural-particles" id="particles"></div>
    <div class="action-flash" id="actionFlash"></div>
    <div class="fixed inset-0 matrix-dots opacity-20 z-0"></div>

    <div class="flex h-screen relative z-10">
        <!-- Dashboard Sidebar -->
        <aside class="w-80 glass border-l border-white/5 p-8 flex flex-col items-center gap-8 floating">
            <div class="text-center">
                <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[2rem] flex items-center justify-center mb-4 shadow-2xl brain-glow relative pulse-cell">
                    <span class="text-4xl">ğŸ§ </span>
                    <div class="absolute -top-1 -right-1 w-4 h-4 bg-emerald-500 border-2 border-slate-900 rounded-full blink-text"></div>
                </div>
                <h1 class="text-2xl font-black tracking-tighter uppercase px-2">Anor Brain</h1>
                <p class="text-[10px] text-blue-400 font-bold tracking-[0.3em] uppercase opacity-60">Neural Orchestrator 3.0</p>
            </div>

            <nav class="w-full space-y-4">
                <div class="p-4 rounded-3xl bg-white/5 border border-white/5 hover:border-blue-500/50 transition-all cursor-pointer group scanning" onclick="processCode()">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-2xl bg-blue-600/20 flex items-center justify-center text-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-all group-hover:rotate-12">âš¡</div>
                        <div>
                            <p class="text-xs font-black text-white">Ø¥Ø¹Ø§Ø¯Ø© Ù‡Ù†Ø¯Ø³Ø© Ø¹ØµØ¨ÙŠØ©</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-widest font-bold">Direct Transformation</p>
                        </div>
                    </div>
                </div>

                <div class="p-4 rounded-3xl bg-white/5 border border-white/5 hover:border-emerald-500/50 transition-all cursor-pointer group" onclick="syncToEditor()">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-2xl bg-emerald-600/20 flex items-center justify-center text-emerald-400 group-hover:bg-emerald-600 group-hover:text-white transition-all group-hover:scale-110">ğŸ§¬</div>
                        <div>
                            <p class="text-xs font-black text-white">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ´Ù</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-widest font-bold">Inject Fixes to Editor</p>
                        </div>
                    </div>
                </div>

                <div class="p-4 rounded-3xl bg-white/5 border border-white/5 hover:border-rose-500/50 transition-all cursor-pointer group" onclick="resetEngine()">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-2xl bg-rose-600/20 flex items-center justify-center text-rose-400 group-hover:bg-rose-600 group-hover:text-white transition-all group-hover:rotate-180">ğŸ§¹</div>
                        <div>
                            <p class="text-xs font-black text-white">ØªØ·Ù‡ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-widest font-bold">Wipe Neural Buffer</p>
                        </div>
                    </div>
                </div>
            </nav>

            <div class="mt-auto w-full p-4 glass rounded-3xl border border-blue-500/20 glow-animation">
                <h4 class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-3">Ø­Ø§Ù„Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ (Agents)</h4>
                <div class="space-y-2">
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <span class="text-slate-400">Security Guardian:</span>
                        <span class="text-emerald-400 blink-text">ACTIVE</span>
                    </div>
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <span class="text-slate-400">Optimizer Core:</span>
                        <span class="text-emerald-400">READY</span>
                    </div>
                    <div class="flex justify-between items-center text-[10px] font-bold">
                        <span class="text-slate-400">Refactor Specialist:</span>
                        <span class="text-blue-400">LISTENING</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Orchestrator -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-20 glass flex items-center justify-between px-10 border-b border-white/5">
                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 bg-blue-600 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.8)] animate-pulse"></span>
                        <span class="text-xs font-black uppercase tracking-widest text-blue-400">Neural Link Stable</span>
                    </div>
                    <div class="h-6 w-[1px] bg-white/10"></div>
                    <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                        Workspace: <span class="text-slate-300" id="workspace-path">/aegis/master/control</span>
                    </div>
                </div>
                <div class="flex gap-4">
                    <button onclick="chooseProject()" class="text-xs font-black bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-2xl transition-all shadow-lg shadow-blue-600/20 hover:scale-105 active:scale-95">Ø¬Ù„Ø¨ Ù…Ø´Ø±ÙˆØ¹ ğŸš€</button>
                    <button onclick="getFiles()" class="text-xs font-black bg-white/5 hover:bg-white/10 border border-white/10 px-6 py-2 rounded-2xl transition-all hover:scale-105 active:scale-95">ØªØ­Ù…ÙŠÙ„ ÙŠØ¯ÙˆÙŠ ğŸ“‚</button>
                </div>
            </header>

            <!-- Grid -->
            <div class="flex-1 p-10 grid grid-cols-1 lg:grid-cols-2 gap-10 overflow-hidden">
                <!-- Code Editor -->
                <div class="flex flex-col gap-5 overflow-hidden">
                    <div class="flex justify-between items-center px-4">
                        <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.3em]">Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ</h3>
                        <div class="flex items-center gap-3">
                            <span id="charCount" class="text-[10px] font-mono text-blue-500">0 lines</span>
                            <span id="autoSaveBadge" class="text-[8px] text-emerald-500 opacity-0 transition-opacity">âœ“ Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
                        </div>
                    </div>
                    <div class="flex-1 relative glass rounded-[2.5rem] overflow-hidden border border-white/5 p-4 scanning">
                        <textarea id="inputCode" oninput="updateStats(); autoSave(); onCodeChange()" class="w-full h-full bg-transparent p-6 font-mono text-sm text-blue-100/80 outline-none resize-none leading-relaxed focus:bg-blue-500/[0.02] transition-all" placeholder="// Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯Ùƒ Ù‡Ù†Ø§ Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹ØµØ¨ÙŠØ©..."></textarea>
                        <div class="absolute bottom-4 left-4 flex gap-2">
                            <span class="text-[8px] text-slate-600" id="liveIndicator">âš¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</span>
                        </div>
                    </div>
                </div>

                <!-- Neural Output -->
                <div class="flex flex-col gap-6 overflow-hidden">
                    <div class="flex justify-between items-center px-4">
                        <h3 class="text-xs font-black text-blue-400 uppercase tracking-[0.3em]">Ù†ØªØ§Ø¦Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</h3>
                        <div id="loadingStatus" class="hidden flex items-center gap-2">
                            <span class="text-[10px] font-bold text-emerald-400 uppercase">Processing...</span>
                            <div class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></div>
                        </div>
                    </div>

                    <!-- Brain Analysis -->
                    <div class="h-1/3 glass rounded-[2.5rem] border-r-4 border-blue-600 p-8 overflow-y-auto relative" id="analysisContainer">
                        <div id="analysisOut" class="text-sm text-slate-300 leading-relaxed font-['IBM_Plex_Sans_Arabic']">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø§Ø±Ø§Øª Ø¨Ø±Ù…Ø¬ÙŠØ© Ù„Ø¨Ø¯Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ...</div>
                        <div class="absolute top-4 left-4">
                            <span class="text-[8px] text-blue-500/50 blink-text">ğŸ”µ Ø§Ø³ØªØ´Ø¹Ø§Ø± Ø­ÙŠ</span>
                        </div>
                    </div>

                    <!-- Fixed Code -->
                    <div class="flex-1 glass rounded-[2.5rem] border-r-4 border-emerald-500 p-8 flex flex-col relative overflow-hidden code-correction">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[10px] font-black text-emerald-400 uppercase tracking-[0.2em]">Optimized Output</span>
                            <button onclick="copyCode()" class="text-[9px] bg-slate-800 hover:bg-slate-700 px-3 py-1 rounded-xl transition-all uppercase font-black border border-white/5 hover:scale-105 active:scale-95">Copy Code</button>
                        </div>
                        <div class="relative flex-1">
                            <pre class="absolute inset-0 bg-black/40 rounded-3xl p-6 border border-white/5 overflow-auto text-xs leading-loose"><code id="codeOut" class="language-javascript"></code></pre>
                            <div id="correctionOverlay" class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-0 transition-opacity duration-300">
                                <span class="text-6xl animate-ping">âœ¨</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Console logs -->
            <footer class="h-44 glass border-t border-white/5 p-8 flex flex-col gap-4">
                <div class="flex items-center gap-3">
                    <span class="text-[10px] font-black text-slate-600 uppercase tracking-[0.5em]">Neural Activity Logs</span>
                    <div class="flex-1 h-[1px] bg-white/5"></div>
                    <span class="text-[8px] text-emerald-500/50" id="logCounter">0 Ø£Ø­Ø¯Ø§Ø«</span>
                </div>
                <div id="systemLogs" class="flex-1 font-mono text-[10px] text-blue-300/40 overflow-y-auto space-y-2 pr-6">
                    <div class="log-line">System Status: SYNAPTIC LINK ESTABLISHED...</div>
                    <div class="log-line">Neural Orchestrator: STANDBY MODE</div>
                </div>
            </footer>
        </main>
    </div>

    <script>
        // Constants
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:3000' : '';
        const STORAGE_KEY = 'anor-matrix-code';
        const MAX_FILE_SIZE = 5 * 1024 * 1024;
        const ALLOWED_EXTENSIONS = ['.js', '.jsx', '.ts', '.tsx', '.json', '.html', '.css', '.scss'];
        const IGNORED_DIRS = ['node_modules', '.git', 'dist', 'build', '.cache'];
        
        let lastFix = "";
        let autoSaveTimer = null;
        let logCount = 2;

        // Create particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.background = `rgba(${Math.random() * 100 + 55}, ${Math.random() * 100 + 55}, 255, 0.5)`;
                container.appendChild(particle);
            }
        }

        // Flash action effect
        function flashAction(color = 'blue') {
            const flash = document.getElementById('actionFlash');
            flash.style.background = `radial-gradient(circle, rgba(${color === 'blue' ? '59,130,246' : '16,185,129'},0.3) 0%, transparent 70%)`;
            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 300);
        }

        // Shake element
        function shakeElement(elementId) {
            const el = document.getElementById(elementId);
            el.style.transform = 'translateX(5px)';
            setTimeout(() => el.style.transform = 'translateX(-5px)', 50);
            setTimeout(() => el.style.transform = 'translateX(3px)', 100);
            setTimeout(() => el.style.transform = 'translateX(-2px)', 150);
            setTimeout(() => el.style.transform = 'translateX(0)', 200);
        }

        // Pulse element
        function pulseElement(elementId) {
            const el = document.getElementById(elementId);
            el.style.transform = 'scale(1.02)';
            setTimeout(() => el.style.transform = 'scale(1)', 200);
        }

        // Show correction effect
        function showCorrectionEffect() {
            const overlay = document.getElementById('correctionOverlay');
            overlay.style.opacity = '1';
            setTimeout(() => overlay.style.opacity = '0', 500);
            
            const codeOut = document.getElementById('codeOut');
            codeOut.classList.add('typing-effect');
            setTimeout(() => codeOut.classList.remove('typing-effect'), 1000);
        }

        // Add log
        function addLog(msg, type = 'info') {
            const logs = document.getElementById('systemLogs');
            const time = new Date().toLocaleTimeString('ar-SA', { hour12: false });
            const colors = { 
                info: 'text-blue-400/50 border-blue-400', 
                success: 'text-emerald-400 border-emerald-400', 
                warning: 'text-yellow-400 border-yellow-400',
                alert: 'text-rose-400 border-rose-400' 
            };
            
            const logDiv = document.createElement('div');
            logDiv.className = `log-line ${colors[type] || colors.info}`;
            logDiv.innerHTML = `[${time}] ${msg}`;
            
            logs.appendChild(logDiv);
            logs.scrollTop = logs.scrollHeight;
            
            logCount++;
            document.getElementById('logCounter').textContent = `${logCount} Ø£Ø­Ø¯Ø§Ø«`;
            flashAction(type === 'success' ? 'green' : 'blue');
        }

        // Update stats
        function updateStats() {
            const code = document.getElementById('inputCode').value;
            const lines = code.split('\n').length;
            const chars = code.length;
            document.getElementById('charCount').innerHTML = `${lines} lines | ${chars} chars`;
            
            document.getElementById('liveIndicator').innerHTML = 'âš¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©';
            clearTimeout(window.liveTimeout);
            window.liveTimeout = setTimeout(() => {
                document.getElementById('liveIndicator').innerHTML = 'ğŸ’¤ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
            }, 2000);
        }

        // On code change
        function onCodeChange() {
            pulseElement('charCount');
        }

        // Auto save
        function autoSave() {
            const code = document.getElementById('inputCode').value;
            localStorage.setItem(STORAGE_KEY, code);
            
            const badge = document.getElementById('autoSaveBadge');
            badge.classList.remove('opacity-0');
            
            if (autoSaveTimer) clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                badge.classList.add('opacity-0');
            }, 2000);
        }

        // Load on page load
        window.addEventListener('load', () => {
            createParticles();
            const savedCode = localStorage.getItem(STORAGE_KEY);
            if (savedCode) {
                document.getElementById('inputCode').value = savedCode;
                updateStats();
                addLog('ğŸ”„ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¢Ø®Ø± Ø¬Ù„Ø³Ø© Ø¹Ù…Ù„', 'info');
            }
        });

        // Get files
        async function getFiles() {
            flashAction('blue');
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.multiple = true;
            
            input.onchange = async (e) => {
                const files = Array.from(e.target.files);
                addLog(`ğŸ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${files.length} Ù…Ù„Ù. Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙÙ„ØªØ±Ø©...`);
                
                let buffer = "";
                let processedCount = 0;
                let skippedCount = 0;
                
                for (let file of files) {
                    if (IGNORED_DIRS.some(dir => file.webkitRelativePath.includes(dir))) {
                        skippedCount++;
                        continue;
                    }
                    
                    const fileExt = '.' + file.name.split('.').pop()?.toLowerCase();
                    if (!ALLOWED_EXTENSIONS.includes(fileExt)) {
                        skippedCount++;
                        continue;
                    }
                    
                    if (file.size > MAX_FILE_SIZE) {
                        addLog(`âš ï¸ ØªØ¬Ø§ÙˆØ² ${file.name} Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­`, 'warning');
                        skippedCount++;
                        continue;
                    }
                    
                    try {
                        const text = await file.text();
                        buffer += `\n/* --- ğŸ“„ ${file.webkitRelativePath} --- */\n${text}\n`;
                        processedCount++;
                    } catch (err) {
                        addLog(`âŒ ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© ${file.name}: ${err.message}`, 'alert');
                    }
                }
                
                document.getElementById('inputCode').value = buffer;
                updateStats();
                addLog(`âœ… Ø§ÙƒØªÙ…Ù„: ${processedCount} Ù…Ù„ÙØŒ ${skippedCount} ØªÙ… ØªØ®Ø·ÙŠÙ‡`, 'success');
                flashAction('green');
            };
            
            input.click();
        }

        // Process code
        async function processCode() {
            const code = document.getElementById('inputCode').value;
            if (!code) {
                addLog('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'warning');
                shakeElement('inputCode');
                return;
            }

            flashAction('blue');
            addLog("ğŸ§  Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹ØµØ¨ÙŠØ©...");
            document.getElementById('loadingStatus').classList.remove('hidden');
            
            const analysisOut = document.getElementById('analysisOut');
            const codeOut = document.getElementById('codeOut');
            const analysisContainer = document.getElementById('analysisContainer');

            analysisOut.innerHTML = `
                <div class="flex items-center gap-3 animate-pulse">
                    <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                    <span class="w-3 h-3 bg-blue-500 rounded-full animate-ping" style="animation-delay: 0.2s"></span>
                    <span class="mr-2">ØªÙÙƒÙŠØ± Ø¹ØµØ¨ÙŠ Ø¬Ø§Ø±Ù...</span>
                </div>
            `;

            analysisContainer.classList.add('scanning');

            try {
                await new Promise(r => setTimeout(r, 1500));
                
                const issues = analyzeCode(code);
                const fixed = fixCode(code, issues);
                
                setTimeout(() => {
                    showCorrectionEffect();
                    
                    let reportHTML = generateAnalysisReport(issues);
                    analysisOut.innerHTML = reportHTML;
                    
                    codeOut.textContent = fixed;
                    lastFix = fixed;
                    Prism.highlightElement(codeOut);
                    
                    const errorCount = issues.filter(i => i.severity === 'error').length;
                    const warningCount = issues.filter(i => i.severity === 'warning').length;
                    
                    addLog(`âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${errorCount} Ø£Ø®Ø·Ø§Ø¡ØŒ ${warningCount} ØªØ­Ø°ÙŠØ±Ø§Øª`, 'success');
                    flashAction('green');
                }, 2000);

            } catch (err) {
                analysisContainer.classList.remove('scanning');
                addLog('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'alert');
                analysisOut.innerHTML = `<div class="text-rose-400">ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>`;
            } finally {
                document.getElementById('loadingStatus').classList.add('hidden');
                analysisContainer.classList.remove('scanning');
            }
        }

        // Analyze code
        function analyzeCode(code) {
            const issues = [];
            const lines = code.split('\n');
            
            lines.forEach((line, index) => {
                const lineNum = index + 1;
                
                if (line.includes('console.log') && !line.includes('//')) {
                    issues.push({
                        line: lineNum,
                        message: 'Ø§Ø³ØªØ®Ø¯Ø§Ù… console.log ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬',
                        severity: 'warning'
                    });
                }
                
                if (line.includes('var ')) {
                    issues.push({
                        line: lineNum,
                        message: 'Ø§Ø³ØªØ®Ø¯Ø§Ù… var Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† let/const',
                        severity: 'warning'
                    });
                }
                
                if (line.includes('== ') && !line.includes('===')) {
                    issues.push({
                        line: lineNum,
                        message: 'Ø§Ø³ØªØ®Ø¯Ø§Ù… == Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ===',
                        severity: 'error'
                    });
                }
            });
            
            return issues;
        }

        // Fix code
        function fixCode(code, issues) {
            return code;
        }

        // Generate analysis report
        function generateAnalysisReport(issues) {
            const errorCount = issues.filter(i => i.severity === 'error').length;
            const warningCount = issues.filter(i => i.severity === 'warning').length;
            
            return `
                <div class="space-y-4">
                    <div class="flex gap-3 p-4 bg-slate-800/50 rounded-xl">
                        <div class="flex-1 text-center">
                            <span class="text-2xl block text-rose-400 font-bold">${errorCount}</span>
                            <span class="text-[9px] uppercase opacity-60">Ø£Ø®Ø·Ø§Ø¡</span>
                        </div>
                        <div class="flex-1 text-center">
                            <span class="text-2xl block text-yellow-400 font-bold">${warningCount}</span>
                            <span class="text-[9px] uppercase opacity-60">ØªØ­Ø°ÙŠØ±Ø§Øª</span>
                        </div>
                    </div>
                    ${issues.length === 0 ? '<div class="text-emerald-400 text-center p-6">âœ¨ ÙƒÙˆØ¯ Ù…Ø«Ø§Ù„ÙŠ!</div>' : ''}
                </div>
            `;
        }

        // Choose project
        function chooseProject() {
            addLog('ğŸ“ ÙØªØ­ Ù…Ø±Ø¨Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹...', 'info');
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.onchange = (e) => {
                const files = Array.from(e.target.files);
                addLog(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${files.length} Ù…Ù„Ù`, 'success');
            };
            input.click();
        }

        // Sync to editor
        function syncToEditor() {
            if (lastFix) {
                document.getElementById('inputCode').value = lastFix;
                updateStats();
                addLog('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ­Ø­ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø±Ø±', 'success');
                flashAction('green');
            } else {
                addLog('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù…ØµØ­Ø­ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†', 'warning');
            }
        }

        // Reset engine
        function resetEngine() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                document.getElementById('inputCode').value = '';
                document.getElementById('analysisOut').innerHTML = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø§Ø±Ø§Øª Ø¨Ø±Ù…Ø¬ÙŠØ©...';
                document.getElementById('codeOut').textContent = '';
                lastFix = "";
                updateStats();
                addLog('ğŸ§¹ ØªÙ… ØªØ·Ù‡ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                flashAction('green');
            }
        }

        // Copy code
        function copyCode() {
            if (lastFix) {
                navigator.clipboard.writeText(lastFix).then(() => {
                    addLog('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
                    flashAction('green');
                }).catch(err => {
                    addLog('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', 'alert');
                });
            } else {
                addLog('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ Ù„Ù„Ù†Ø³Ø®', 'warning');
            }
        }
    </script>
</body>

</html>
